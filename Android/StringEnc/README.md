# Android 字符串加密

## 0x00 前言
字符串加密一定程度上可以抵抗静态分析，但是这个加密又不能太复杂，因为字符串一多，还是会影响性能的。

## 0x01 设计思路
在写这个代码的时候我考虑了两个问题，一个是有源码的情况，一个是无源码的情况。无源码的情况需要去搞smali代码，其他两个都差不多，直接正则去匹配字符串，然后替换成加密字符串以及调用解密函数。但是这个方式，所有的字符串都会经过固定的函数进行解密，所以一旦逆向狗hook了这个类，我们就没有办法了。然后针对这种情况，有一个办法就是一个类一个解密函数，这个也是DexGuard做的方案，不过不知道现在是什么方案了。总之，DexGuard的方案会更强一些。

## 0x02 主要遇到的问题
首先是匹配上，如何去匹配不同种类下的字符串，这里需要一个比较好的正则去匹配。我自己搞的这个在遇到转义字符的时候就会gg，这个问题待解决。其次是如何进行加密的问题，这个加密不能太复杂，会影响效率，其次，这个被解密难度要大，让攻击者放弃。最后就是在于替换的问题，这个比较好解决，正则表达式提供了替换的方法，我们可以加以利用。实践之后发现其实问题还是挺多的，比如说注解中的字符串不能加密， 还有很多场景也不能使用。

## 0x03 后续计划
后续的计划当然是实现DexGuard的方案，不过我暂时还没有什么思路。如果对这个项目感兴趣可以Star或者自行修改

## 0x04 如何使用
目录中的.java是java层解密用的，直接集成到项目中，改包名就好。然后因为包名改动了，所以regex中报名也需要进行改动。当然这里其实可以在脚本初始化的时候就设定好包名，这个轮子我就不造了。关于native层，需要讲.h 和.c 文件导入项目，然后在需要加密的.c文件中加入头文件“dec.h” ,然后直接使用DECRYPPT()包裹字符串就好，这里也需要注意，有些场景是不能够使用字符串加密的，另外就是如果自己使用了LOG系列函数，需要多加代码，为了防止字符串格式化漏洞

2017.7.10
> 目前的版本可以对java层进行简单加密了(base64 ,hex) ,接下来对native层进行加密，方法其实也挺多的。再完成native之后就是研究dexguard，哦，对，之前还得对代码进行一定的重构，把对应的方式写成一个类就方便很多了

2017.7.11
> 目前完成了native层的加密，但是都是demo版本吧，可以看到现在的代码很乱。当初设计的时候是准备把3种方式写到3个文件的，结果现在加密的全在一起了，所以接下来就尽可能重构成一个类来写。接下来就是完善代码，加一些选项，然后运用到生产中。之后就是搞一下dexguard了。

2017.7.14
> 修复了一些bug,决定不启用class ，现在已经可以用到生产中了。当然，目前如果你们要采用的话，还需要改一些包名什么的

2017.7.15
> native 加密修改了下，接下来只剩dexguard 了

2017.7.23
> 靠hook的方式对字符串解密，这种方式对于喜欢静态分析的我，不怎么喜欢，所以看这官方文档写了一个解密脚本，只是2.2.7的脚本，至于怎么安装，运行就自己去看script目录下的文档了。dexguard 打算月底出demo，但是估计可能会延期
